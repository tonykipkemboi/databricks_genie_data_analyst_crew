natural_language_db_query_task:
  description: >
    The user has asked the following question about our data: "{query}".
    Use your Databricks Genie tool to get the answer.
    Determine if the user needs the actual data results or just the SQL and Genie's explanation.
    If this is a follow-up, ensure you use the correct conversation ID (if provided from previous context).
    For this query, fetch_query_results should be {fetch_results_flag}.
  expected_output: >
    A clear answer to the user's question, including the SQL query generated by Genie,
    Genie's textual explanation, the relevant conversation ID for potential follow-ups,
    and the data results if requested and successfully retrieved. 
    Output the results in markdown format to be used in a report and saved to the output/databricks_query_output.md file.
    Format the file correctly with the title, {date}, icon, and content correct as a .md file without the "```md" and "```" tags.

    The file should be in the following format:
    ```md
    # Top 3 Products in 2024

    **Date:** 2025-08-15  
    **Icon:** ðŸ“Š  

    **Query:**  
    ```sql
    WITH yearly_sales AS (
      SELECT
        product,
        SUM(totalPrice) AS total_sales
      FROM samples.bakehouse.sales_transactions
      WHERE YEAR(dateTime) = 2024
      GROUP BY product
    )
    SELECT
      product,
      total_sales
    FROM yearly_sales
    ORDER BY total_sales DESC
    LIMIT 3;
    ```

    **Query Results:**
    | Product                  | Total Sales |
    |--------------------------|-------------|
    | Golden Gate Ginger       | 11595       |
    | Outback Oatmeal         | 11199       |
    | Austin Almond Biscotti   | 11148       |
    ```
    <important>DO NOT INCLUDE THE ```md tags in the file.</important>
  agent: databricks_query_agent
